<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Phase Panner</title>
<script src="load.js"></script>
</head>
<body>
<fieldset>
<legend><h2>Parameters</h2></legend>
<label>frequency: <input type="number" id="frequency" value="700"></label>
<label>overlap: <input type="range" id="overlap" value="35"> %</label>
</fieldset>

<audio-context hide-on-bypass automation-interval="default{0.05} shortcut{a}" label="Phase Panner"> 
<audio-series>
<audio-player label="player" src="default{t1.mp3} shortcut{u}" play="shortcut{p}" seek="shortcut{k}"></audio-player>


<!--<audio-split label="wide delay" hide="mix">
<audio-gain></audio-gain>
<audio-delay label="widen" delay="0.010" hide="bypass mix"></audio-delay>
</audio-split>
-->

<audio-series id="master" label="master" mix="-0.5">

<audio-swap></audio-swap>
<audio-parallel>
<audio-series silent-bypass id="lowband" label="low band" hide="mix">
<audio-filter label="low filter" type="lowpass" frequency="1000" q="4" hide="mix type gain detune"></audio-filter>
<audio-stereo-processor label="rotate low" rotate="default{-45} automate{s(t/2, -135,135)}" hide="bypass mix width center balance"></audio-stereo-processor>

</audio-series><audio-series silent-bypass id="highband" label="high band" hide="mix">
<audio-filter label="high filter" type="highpass" frequency="1000" q="4" hide="mix type gain detune"></audio-filter>
<audio-stereo-processor label="rotate high" rotate="default{57} automate{-1*s(t/7, -90,90)}" hide="bypass mix  width center balance"></audio-stereo-processor>
<audio-gain label="gain" gain="2.0" hide="mix bypass"></audio-gain>
</audio-series>
</audio-parallel>


<audio-filter label="bass" type="lowshelf" frequency="150" gain="4.0" hide="mix type q detune"></audio-filter>
</audio-series><!-- master -->
<audio-gain label="volume" gain="1.0" hide="mix bypass"></audio-gain>


<audio-destination label="speakers"></audio-destination>
</audio-series>
</audio-context>

<script>
document.querySelector("audio-context").addEventListener("complete", e => {
e.target.message = "Ready.";
const frequency = document.querySelector("#frequency");
const overlap = document.querySelector("#overlap");
frequency.addEventListener("change", setFilterFrequencies);
overlap.addEventListener("change", setFilterFrequencies);
setFilterFrequencies();

function setFilterFrequencies () {
setFrequenciesWithOverlap (
Number(frequency.value),
Number(overlap.value),
...document.querySelectorAll("#lowband audio-filter, #highband audio-filter")
);
} // setFilterFrequencies

function setFrequenciesWithOverlap (frequency, percentOverlap, f1, f2) {
// f1 should be low band
const overlap = frequency * percentOverlap*.01;
f1.frequency = frequency + overlap;
f2.frequency = frequency - overlap;
//console.debug("overlap: ", frequency, percentOverlap, overlap, f1, f2);
} // setFrequenciesWithOverlap 
}); // ready
</script>

</body>
</html>
